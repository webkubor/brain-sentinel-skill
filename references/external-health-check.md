---
id: external-health-check
triggers: ["自检", "健康检查", "系统检查", "health check"]
priority: 1
---

## 🧠 外部大脑健康检查标准

> **原则**: 每次任务启动前和切换 Agent 时，必须执行自检，确认外部大脑处于可用状态。

> **区分**: 这是**静态知识库自检**，检查路径、链接、结构完整性。记忆哨兵（自动记录操作）是另一个独立机制。

## 🎯 自检目的

## 1️⃣ 启动前自检

### 检查清单

- **✅ 路径可达性**
  - [ ] `router.md` 可读取
  - [ ] 核心目录存在：`rules/`, `skills/`, `agents/`
  - [ ] 凭证目录存在：`secrets/`

- **✅ 配置一致性**
  - [ ] `docs/.vitepress/config.mjs` 语法正确
  - [ ] 所有 sidebar 链接指向实际文件
  - [ ] `tech_stack.md` 依赖无冲突

- **✅ 记忆系统**
  - [ ] `memory/journal/` 目录不为空
  - [ ] 最新日志可访问
  - [ ] 没有未解决的"待办"状态

### 复盘记录模板

```markdown
## 🧠 启动前自检 - 2026-02-26

### 检查结果
- [x] router.md 可读 ✅
- [x] 核心目录完整 ✅
- [ ] ... (其他检查)

### 发现的问题
- [记录任何发现的问题]

### 需要关注的事项
- [ ] ... (需要接下来检查的事项)
```

## 2️⃣ 执行中自检

### 周期性检查

- **Token 使用监控**
  - 定期查看当前 Token 占用
  - 避免接近上下文上限

- **进度回溯**
  - 每完成一个阶段，记录进度
  - 确认完成项都标记 [x]

- **文档访问检查**
  - 确认引用的文档路径存在
  - 避免出现"404"路径错误

## 3️⃣ 切换后自检

### 上下文同步检查

切换 Agent 时必须确认：

- [ ] 新 Agent 已读取最新日志
- [ ] 新 Agent 知道当前进度（已完成/进行中/待办）
- [ ] 所有文件变更已记录

### 路径完整性检查

- [ ] `docs/router.md` 中的所有路径都已验证
- [ ] `docs/.vitepress/config.mjs` 中的 sidebar 链接有效
- [ ] 没有"孤儿"引用（引用但不存在）

## 4️⃣ 复盘后的自检

每次复盘完成后，执行：

- [ ] 修复路径引用错误
- [ ] 更新索引文档
- [ ] 检查是否有其他文档引用了已修改的文档

## 🔍 健康检查命令

```bash
# 检查所有 Markdown 文件路径
grep -r "link: /" docs/.vitepress/config.mjs

# 检查 router.md 中的路径引用
grep -E "docs/[^)]+\.md" docs/router.md

# 检查是否有未使用的目录
find docs -type d -empty

# 验证 JSON 语法
find docs -name "*.json" -exec node -e "JSON.parse(require('fs').readFileSync('{}', 'utf8'))" \;
```

## ⚠️ 严重问题处理

如果发现：

1. **无法读取核心文件**
   - 立即停止任务
   - 修复文件后重试
   - 记录问题到 memory/journal

2. **Sidebar 链接全部失效**
   - 逐一验证链接
   - 修复或删除无效链接
   - 不要影响现有文档

3. **凭证文件缺失**
   - 立即声明无法继续
   - 指引用户手动补充
   - 不要尝试生成或猜测

---

**自检是外部大脑可用性的保证，不要跳过！**